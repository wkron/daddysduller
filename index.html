<body>

  <h1>üç∫ Fad√∏l Tracker</h1>

  <div>
    <input id="name" placeholder="Dit navn">
  </div>

  <div style="margin-top: 1rem;">
    <button onclick="addBeer()">+1 fad√∏l</button>
  </div>

  <h2 style="margin-top: 2rem;">
    Total fad√∏l: <span id="total">..‚è≥..</span>
  </h2>

  <h3>üèÜ Leaderboard</h3>
  <ul id="leaderboard"></ul>

  <h3>üìà Fad√∏l over tid</h3>
  <canvas id="beerChart" width="400" height="200"></canvas>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <script>
  const API_URL = "https://script.google.com/macros/s/AKfycbxcRLqrkpSmbjjhscg0kJVNKzmgDhYZmhFW611biTZCNvIycpVac_7iAedzJQWMaU3e/exec";

  let total = 0;

  let chart; // global reference

  function updateFromServer() {
    fetch(API_URL)
      .then(r => r.json())
      .then(rows => {
        // --- TOTAL ---
        const total = rows.reduce((s, r) => s + Number(r[2]), 0);
        setTotal(total);

        // --- LEADERBOARD ---
        const perPerson = {};
        rows.forEach(r => {
          const name = r[1];
          const beers = Number(r[2]);
          perPerson[name] = (perPerson[name] || 0) + beers;
        });

        const leaderboard = document.getElementById("leaderboard");
        leaderboard.innerHTML = "";

        Object.entries(perPerson)
          .sort((a, b) => b[1] - a[1])
          .forEach(([name, beers]) => {
            const li = document.createElement("li");
            li.textContent = `${name}: ${beers}`;
            leaderboard.appendChild(li);
          });

        // --- GRAF ---
        const times = rows.map(r => new Date(r[0]));
        const cumulative = [];
        let sum = 0;
        rows.forEach(r => {
          sum += Number(r[2]);
          cumulative.push(sum);
        });

        const ctx = document.getElementById("beerChart").getContext("2d");

        if (chart) chart.destroy();

        chart = new Chart(ctx, {
          type: "line",
          data: {
            labels: times,
            datasets: [{
              label: "Total fad√∏l",
              data: cumulative,
              tension: 0.3
            }]
          }
        });
      });
  }
  
  function setTotal(value) {
    total = value;
    document.getElementById("total").textContent = total;
  }


  function addBeer() {
    setTotal(total + 1); // optimistic UI

    fetch(API_URL, {
      method: "POST",
      body: JSON.stringify({
        name: document.getElementById("name").value.trim() || "Ukendt",
        beers: 1
      })
    }).then(updateFromServer);
  }



  updateFromServer();


    
  </script>


</body>
