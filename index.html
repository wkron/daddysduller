<body>

  <h1>üç∫ Fad√∏l Tracker</h1>

  <h3>Hvem er du?</h3>
  <div id="people"></div>
  <style>
  #people {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
    gap: 0.5rem;
    max-width: 300px;
    margin: 1rem auto;
  }

  .person-btn {
    padding: 0.6rem;
    font-size: 1rem;
    cursor: pointer;
  }

  .active {
    background: #222;
    color: white;
  }
  #add-beer-container {
  max-width: 300px;          /* samme som #people */
  margin: 1.5rem auto;
  }

  #add-beer-btn {
    width: 100%;
    padding: 1rem;
    font-size: 1.4rem;
    font-weight: bold;
    border-radius: 12px;
    border: none;
    cursor: pointer;

    background: linear-gradient(135deg, #f6c453, #f09c2d);
    color: #222;

    box-shadow: 0 4px 10px rgba(0,0,0,0.15);
    transition: transform 0.05s ease, box-shadow 0.05s ease;
  }

  #add-beer-btn:active {
    transform: translateY(2px);
    box-shadow: 0 2px 6px rgba(0,0,0,0.2);
  }

  #add-beer-btn:disabled {
    opacity: 0.6;
    cursor: not-allowed;
  }

</style>


  <div id="add-beer-container">
    <button id="add-beer-btn" onclick="addBeer()">üç∫ +1 fad√∏l</button>
  </div>

  <h2 style="margin-top: 2rem;">
    Total fad√∏l: <span id="total">..‚è≥..</span>
  </h2>

  <h3>üèÜ Leaderboard</h3>
  <ul id="leaderboard"></ul>

  <h3>üìà Fad√∏l over tid</h3>
  <canvas id="beerChart" width="400" height="200"></canvas>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <script>
  const API_URL = "https://script.google.com/macros/s/AKfycbxcRLqrkpSmbjjhscg0kJVNKzmgDhYZmhFW611biTZCNvIycpVac_7iAedzJQWMaU3e/exec";
  const CSV_URL = "https://docs.google.com/spreadsheets/d/1Nz0i7Q9p61VT15Ia4E5muW4npkYCniaKVtAWBzTnzP8/export?format=csv&gid=0"
    
  let total = 0;

  const PEOPLE = [
    "William",
    "Nikolai",
    "Lise",
    "Mille",
    "Frigg",
    "Augusta",
    "Julle",
    "Milla",
    "Malthe",
    "Baldur"
  ];

  let currentName = localStorage.getItem("name") || null;

  const peopleDiv = document.getElementById("people");

  function renderPeople() {
    peopleDiv.innerHTML = "";

    PEOPLE.forEach(name => {
      const btn = document.createElement("button");
      btn.textContent = name;
      btn.className = "person-btn";

      if (name === currentName) {
        btn.classList.add("active");
      }

      btn.onclick = () => {
        currentName = name;
        localStorage.setItem("name", name);
        renderPeople();
      };

      peopleDiv.appendChild(btn);
    });
  }


  renderPeople();
  updateFromServer();

  let chart; // global reference

  // const nameInput = document.getElementById("name");
  // const savedName = localStorage.getItem("name");
  // if (savedName) nameInput.value = savedName;
    
  function parseCSV(text) {
  return text
    .trim()
    .split("\n")
    .slice(1) // skip header
    .map(row => row.split(","));
  }
  
    
  function updateFromServer() {
    fetch(CSV_URL)
      .then(r => r.text())
      .then(text => {
        const rows = parseCSV(text);

        // TOTAL
        const total =
          rows.reduce((s, r) => s + Number(r[2]), 0);
        setTotal(total);

        // LEADERBOARD
        const perPerson = {};
        rows.forEach(r => {
          const name = r[1];
          const beers = Number(r[2]);
          perPerson[name] = (perPerson[name] || 0) + beers;
        });

        const leaderboard = document.getElementById("leaderboard");
        leaderboard.innerHTML = "";

        const medals = ["ü•á", "ü•à", "ü•â"];
          
        Object.entries(perPerson)
          .sort((a, b) => b[1] - a[1])
          .slice(0, 5)              // top 5
          .forEach(([name, beers], i) => {
            const li = document.createElement("li");
            const medal = medals[i] || "";
            li.textContent = `${medal} ${name}: ${beers}`;
            leaderboard.appendChild(li);
        });


        // GRAF (kumulativ)
        const perDay = {};

        rows.forEach(r => {
          const date = r[0].slice(0, 10); // YYYY-MM-DD
          perDay[date] = (perDay[date] || 0) + Number(r[2]);
        });

        const days = Object.keys(perDay).sort();
        let sum = 0;
        const cumulative = days.map(d => {
          sum += perDay[d];
          return sum;
        });

        if (chart) chart.destroy();
        chart = new Chart(
          document.getElementById("beerChart"),
          {
            type: "line",
            data: {
              labels: days,
              datasets: [{
                label: "Total fad√∏l",
                data: cumulative,
                tension: 0.3
              }]
            }
          }
        );
    });
  }
  

  
  function setTotal(value) {
    total = value;
    document.getElementById("total").textContent = total;
  }


  function addBeer() {
    if (!currentName) {
      alert("V√¶lg dit navn f√∏rst üç∫");
      return;
    }

  
    setTotal(total + 1); // optimistic UI

    fetch(API_URL, {
      method: "POST",
      body: JSON.stringify({
        name: currentName,
        beers: 1
      })
    }).then(updateFromServer);
  }





    
  </script>


</body>
